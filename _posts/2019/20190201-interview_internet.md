---
layout: post
title: 面试之网络相关
category: interview
---
直接上图

![在这里插入图片描述](http://www.laughitover.com/assets/images/2019/databaseIndex/01.png)

![在这里插入图片描述](http://www.laughitover.com/assets/images/2019/databaseIndex/02.png)

**一、请详细介绍一下TCP协议建立连接和终止连接的过程？**
1、建立连接：三次握手
(1) 第一次握手：建立连接时，客户端A发送SYN包(SYN=1)到服务器B，并进入SYN_SEND状态，等待服务器B确认。
 (2) 第二次握手：服务器B收到SYN包，必须确认客户A的SYN(ACK=x+1)，同时自己也发送一个SYN包(SYN=1)，即SYN+ACK包，此时服务器B进入SYN_RECV状态。
 (3) 第三次握手：客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK(ACK=y+1)，此包发送完毕，客户端A和服务器B进入ESTABLISHED状态，完成三次握手。
![在这里插入图片描述](http://www.laughitover.com/assets/images/2019/databaseIndex/03.png)

2、关闭连接：四次挥手
由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这个原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。
（1）客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。
（2）服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。
（3）服务器B关闭与客户端A的连接，发送一个FIN给客户端A。
（4）客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。
![在这里插入图片描述](http://www.laughitover.com/assets/images/2019/databaseIndex/04.png)
**二、TCP协议和UDP协议的区别是什么**
1、TCP协议是有连接的，有连接的意思是开始传输实际数据之前TCP的客户端和服务器端必须通过三次握手建立连接，会话结束之后也要结束连接。而UDP是无连接的
2、TCP协议保证数据按序发送，按序到达，提供超时重传来保证可靠性，UDP不保证按序到达，甚至不保证到达，只是努力交付，即便是按序发送的序列，也不保证按序送到。
3、TCP协议所需资源多，TCP首部需20个字节（不算可选项），UDP首部字段只需8个字节。
4、TCP有流量控制和拥塞控制，UDP没有，网络拥堵不会影响发送端的发送速率
5、TCP是一对一的连接，而UDP则可以支持一对一，多对多，一对多的通信。
6、TCP面向的是字节流的服务，UDP面向的是报文的服务。


**三、为什么建立连接协议是三次握手，而关闭连接却是四次握手呢？**
这是因为建立连接时，它可以把ACK和SYN(ACK起应答作用，而SYN起同步作用)放在一个报文里来发送。但关闭连接时，当收到对方的FIN报文通知时，它仅仅表示对方没有数据发送给你了；但未必你所有的数据都全部发送给对方了，所以需要发送一些数据给对方之后，再发送FIN报文给对方来表示你同意现在可以关闭连接了，这里的ACK报文和FIN报文多数情况下都是分开发送的。

**四、三次握手建立连接时，发送方再次发送确认的必要性（两次握手可以吗）？**
主 要是为了防止已失效的连接请求报文段突然又传到了B,因而产生错误。假定出现一种异常情况，即A发出的第一个连接请求报文段并没有丢失，而是在某些网络结 点长时间滞留了，一直延迟到连接释放以后的某个时间才到达B，本来这是一个早已失效的报文段。但B收到此失效的连接请求报文段后，就误认为是A又发出一次 新的连接请求，于是就向A发出确认报文段，同意建立连接。假定不采用三次握手，那么只要B发出确认，新的连接就建立了，这样一直等待A发来数据，B的许多 资源就这样白白浪费了。

**五、四次挥手释放连接时，等待2MSL的意义？**
第 一，为了保证A发送的最有一个ACK报文段能够到达B。这个ACK报文段有可能丢失，因而使处在LAST-ACK状态的B收不到对已发送的FIN和ACK 报文段的确认。B会超时重传这个FIN和ACK报文段，而A就能在2MSL时间内收到这个重传的ACK+FIN报文段。接着A重传一次确认。
第二，就是防止上面提到的已失效的连接请求报文段出现在本连接中，A在发送完最有一个ACK报文段后，再经过2MSL，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。

>注：MSL即Maximum Segment Lifetime，也就是报文最大生存时间，当TCP连接完成四个报文段的交换时，主动关闭的一方将继续等待一定时间(2-4分钟)

参考文章：https://www.cnblogs.com/zmlctt/p/3690998.html